---
title: "Raport"
author: "Tamara Lipiejko, Daria Lessnau, Amelia Sørensen, Adrianna Ceynowa"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: true        # Dodanie spisu treści
    toc_depth: 2 
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

## Wprowadzenie

Celem tego raportu jest analiza zestawu danych, w tym czyszczenie danych, wizualizacja, analiza opisowa oraz wnioskowanie statystyczne.

Obiektem analizy był zbiór danych, będący jedną z historycznych sprzedaży firmy supermarketów Biedronka, która została zarejestrowana w 3 różnych oddziałach przez 3 miesiące, od stycznia 2019 r. do marca 2019 r.

Dane jakie zostały zebrane są następujące

-   Invoice id - Numer identyfikacyjny faktury sprzedaży wygenerowany komputerowo

-   Branch - Oddział supercentrum

-   City - Lokalizacja supercentrów

-   Customer type - Typ klientów, zarejestrowany przez członków dla klientów korzystających z karty członkowskiej i normalny dla klientów bez karty członkowskiej

-   Gender - Płeć klienta

-   Product line - Ogólne grupy kategoryzacji przedmiotów - akcesoria elektroniczne, akcesoria modowe, żywność i napoje, zdrowie i uroda, dom i styl życia, sport i podróże

-   Unit price - Cena każdego produktu w \$

-   Quantity - Liczba produktów zakupionych przez klienta

-   Tax - Opłata podatkowa w wysokości 5% dla klienta dokonującego zakupu

-   Date - Data zakupu

-   Time - Czas zakupu

-   Payment - Sposób płatności klienta - gotówka, karta kredytowa i portfel elektroniczny

-   COGS - Koszt sprzedawanych towarów

-   Gross margin percentage - Procentowa marża brutto

-   Gross income - Dochód brutto

-   Rating - Ocena satysfakcji klientów dotycząca ich ogólnego doświadczenia zakupowego

## Data Cleansing i Wrangling

### Załadowanie danych i pakietów

```{r load-packages, echo=TRUE, message=FALSE, warning=FALSE}
# Instalacja pakietów (jeśli nie są zainstalowane)
required_packages <- c(
  "naniar", "dplyr", "ggplot2", "prettydoc", "mice", "shape", "jomo", "pan", "tidyverse", "dlookr", "editrules", "VIM", "validate", "errorlocate", "gtsummary", "cardx", "corrplot", "ggstatsplot"
)
new_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)

# Załadowanie pakietów
library(dplyr)
library(ggplot2)
library(naniar)
library(mice)
library(editrules)
library(validate)
library(corrplot)
library(gtsummary)
library(ggstatsplot)
library(errorlocate)
library(VIM)
```

### Wczytanie danych

```{r read-data, echo=TRUE, message=FALSE, warning=FALSE}
# Wczytanie danych
library(readr)
supermarket_new <- read_csv("supermarket_new.csv")

# Podstawowa charakterystyka danych
summary(supermarket_new)
```

Dane zawierają informacje o sprzedaży, takie jak lokalizacja sklepów, ceny jednostkowe, ilości zakupionych produktów, rodzaj płatności i oceny klientów.

### Czyszczenie danych

#### Sprawdzenie braków danych

Braki danych mogą wskazywać na problemy w procesie zbierania informacji. Sprawdzamy, które zmienne są najbardziej narażone na niekompletność.

```{r missing-values, echo=TRUE, message=FALSE, warning=FALSE}
# Liczba braków danych
n_miss(supermarket_new)
pct_miss(supermarket_new)
miss_var_summary(supermarket_new)
```

#### Usuwanie wartości specjalnych i zastosowanie reguł walidacji

Reguły walidacji pomagają w wykrywaniu i eliminowaniu błędnych wartości, co poprawia jakość analizowanych danych.

```{r data-cleaning, echo=TRUE, message=FALSE, warning=FALSE}
is.special <- function(x) {
  if (is.numeric(x)) !is.finite(x) else is.na(x)
}
for (n in colnames(supermarket_new)) {
  is.na(supermarket_new[[n]]) <- is.special(supermarket_new[[n]])
}

# Reguły walidacji
rules <- validator(
  `Unit price` > 0,
  Total <= `Unit price` * Quantity + `Tax 5%`,
  Rating >= 1 & Rating <= 10
)

# Zastosowanie reguł
validation_results <- confront(supermarket_new, rules)
summary(validation_results)

czyste_dane <-
  supermarket_new %>%
  replace_errors(rules)

errors_removed(czyste_dane)
```

------------------------------------------------------------------------

## Wizualizacja Danych

### Braki danych

Wykrezy wizualizujące braki danych pomagają określić, które zmienne najczęściej zawierają braki.

```{r visualize-missing-data, echo=TRUE, message=FALSE, warning=FALSE}
# Mapa braków danych
vis_miss(supermarket_new)

# UpSet plot dla współwystępowania braków
library(naniar)
gg_miss_upset(supermarket_new, nsets = 3)
```

Na podstawie wykresów można stwierdzić, że braki danych występują w kolumnach City, Gross income oraz Rating. Najczęściej brakuje danych w pojedynczych kolumnach, co może sugerować niezależne mechanizmy ich utraty. Najwięcej braków występuje w kolumnie City (116), następnie Rating (113), a potem gross income (20). 

### Wykresy zależności

Analiza pokazuje, czy oceny klientów mają związek z dochodem brutto oraz czy różnią się w zależności od lokalizacji sklepu. Brak wyraźnej zależności między dochodem brutto a oceną – punkty są rozrzucone losowo, co sugeruje brak silnej korelacji. Oznacza to, że wyższy dochód brutto niekoniecznie prowadzi do wyższej oceny.

```{r scatter-plots, echo=TRUE, message=FALSE, warning=FALSE}
# Zależność między Rating a Gross Income
ggplot(supermarket_new, aes(x = `gross income`, y = Rating)) +
  geom_point(aes(color = City), size = 2) +
  theme_minimal()

# Zależność między Rating a City
ggplot(supermarket_new, aes(x = Rating, y = City)) +
  geom_point(color = "darkorange", size = 2) +
  theme_minimal()
```

Rozkład punktów sugeruje, że oceny są podobne we wszystkich miastach – brak wyraźnych trendów wskazujących, że w jednym mieście oceny są wyższe lub niższe.


```{r clean data, echo=TRUE, message=FALSE, warning=FALSE}
czyste_dane <- hotdeck(supermarket_new)

# Remove all *_imp columns
czyste_dane <- czyste_dane[, !grepl("_imp$", names(czyste_dane))]

```

### Wykresy podsumowujące sprzedaż

Wykres przedstawia sumaryczną sprzedaż w Biedronkach w trzech miastach: Mandalay, Naypyitaw i Yangon. Dane zostały pogrupowane według miasta, a następnie obliczono sumę sprzedaży dla każdego z nich. We wszystkich trzech miastach sprzedaż jest na bardzo zbliżonym poziomie, różnice między nimi są niewielkie. Najwyższa sprzedaż występuje w Naypyitaw, ale różnica względem pozostałych miast nie jest znacząca. Yangon ma najniższą sprzedaż, ale nie jest to duża różnica.


```{r summary-plots, echo=TRUE, message=FALSE, warning=FALSE}
# Sprzedaż Total według miasta
czyste_dane %>%
  group_by(City) %>%
  summarise(Total_Sum = sum(Total, na.rm = TRUE)) %>%
  ggplot(aes(x = City, y = Total_Sum, fill = City)) +
  geom_bar(stat = "identity") +
  theme_minimal()

# Sprzedaż według typu klienta
czyste_dane %>%
  group_by(`Customer type`) %>%
  summarise(Total = n()) %>%
  ggplot(aes(x = `Customer type`, y = Total, fill = `Customer type`)) +
  geom_bar(stat = "identity") +
  theme_minimal()
```

Słupki są prawie równej wysokości, co oznacza, że liczba zakupów dokonywanych przez członków i zwykłych klientów jest zbliżona. Wykres pokazuje liczbę transakcji (nie sumę sprzedaży w wartości pieniężnej). Może to sugerować, że zarówno członkowie, jak i zwykli klienci dokonują podobnej liczby zakupów, ale nie wiadomo, czy ich średnia wartość koszyka zakupowego jest taka sama.

------------------------------------------------------------------------

## Analiza Opisowa

### Statystyki opisowe dla wybranych zmiennych

Statystyki opisowe dostarczają podstawowych informacji o rozkładzie zmiennych w zależności od płci klientów.

```{r descriptive-statistics, echo=TRUE, message=FALSE, warning=FALSE}
czyste_dane %>%
  select(City, Gender, `Customer type`, `Product line`, Total, Rating, Quantity) %>%
  tbl_summary(by = Gender) %>%
  add_p() %>%
  bold_labels()
```

### Macierz korelacji

Macierz korelacji pozwala określić, jakie zależności występują między zmiennymi numerycznymi.

```{r correlation-matrix, echo=TRUE, message=FALSE, warning=FALSE}
# Obliczanie korelacji
numeric_data <- czyste_dane %>% select(`Unit price`, Quantity, Total, `Tax 5%`)
corr_matrix <- cor(numeric_data, use = "complete.obs")

# Wizualizacja macierzy korelacji
corrplot(corr_matrix, method = "color")
```

------------------------------------------------------------------------

## Wnioskowanie Statystyczne

### Porównanie cen jednostkowych między liniami produktów

Analiza pokazuje, które linie porduktów różnią się istotnie pod względem ceny jednostkowej.

```{r unit-price-comparison, echo=TRUE, message=FALSE, warning=FALSE}
czyste_dane %>%
  ggbetweenstats(
    x = `Product line`,
    y = `Unit price`,
    pairwise.comparisons = TRUE,
    p.adjust.method = "bonferroni",
    ggtheme = theme_minimal()
  )
```

### Porównanie cen jednostkowych według typu klienta

Analiza pokazuje, które typy klientów różnią się istotnie pod względem ceny jednostkowej.

```{r customer-type-comparison, echo=TRUE, message=FALSE, warning=FALSE}
czyste_dane %>%
  ggbetweenstats(
    x = `Customer type`,
    y = `Unit price`,
    pairwise.comparisons = TRUE,
    p.adjust.method = "bonferroni",
    ggtheme = theme_minimal()
  )
```

------------------------------------------------------------------------

## Podsumowanie i Wnioski

Na podstawie analizy danych supermarketu można wyciągnąć następujące wnioski:

-   Cena jednostkowa istotnie różni się pomiędzy różnymi liniami produktów.
-   Sprzedaż Total wykazuje różnice w zależności od miasta oraz rodzaju klientów.
-   Niektóre zmienne posiadały braki danych, jednak zostały one skutecznie zarządzone poprzez imputację.
-   Korelacja między zmiennymi pozwala lepiej zrozumieć, jakie czynniki wpływają na poziom sprzedaży i satysfakcję klientów.

Szczegółowe wykresy i tabele wspomagają wizualizację tych wyników.

------------------------------------------------------------------------
