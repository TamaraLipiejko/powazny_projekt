---
title: "Raport"
author: "Tamara Lipiejko, Daria Lessnau, Amelia Sørensen, Adrianna Ceynowa"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: true        # Dodanie spisu treści
    toc_depth: 2 
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

## Wprowadzenie

Obiektem analizy był zbiór danych, będący jedną z historycznych sprzedaży firmy supermarketów Biedronka, która została zarejestrowana w 3 różnych oddziałach przez 3 miesiące, od stycznia 2019 r. do marca 2019 r.

Dane jakie zostały zebrane są następujące

-   Invoice id - Numer identyfikacyjny faktury sprzedaży wygenerowany komputerowo

-   Branch - Oddział supercentrum

-   City - Lokalizacja supercentrów

-   Customer type - Typ klientów, zarejestrowany przez członków dla klientów korzystających z karty członkowskiej i normalny dla klientów bez karty członkowskiej

-   Gender - Płeć klienta

-   Product line - Ogólne grupy kategoryzacji przedmiotów - akcesoria elektroniczne, akcesoria modowe, żywność i napoje, zdrowie i uroda, dom i styl życia, sport i podróże

-   Unit price - Cena każdego produktu w \$

-   Quantity - Liczba produktów zakupionych przez klienta

-   Tax - Opłata podatkowa w wysokości 5% dla klienta dokonującego zakupu

-   Date - Data zakupu

-   Time - Czas zakupu

-   Payment - Sposób płatności klienta - gotówka, karta kredytowa i portfel elektroniczny

-   COGS - Koszt sprzedawanych towarów

-   Gross margin percentage - Procentowa marża brutto

-   Gross income - Dochód brutto

-   Rating - Ocena satysfakcji klientów dotycząca ich ogólnego doświadczenia zakupowego

## Wprowadzenie

Celem tego raportu jest analiza danych z supermarketu, w tym czyszczenie danych, wizualizacja, analiza opisowa oraz wnioskowanie statystyczne. Dane zawierają informacje o sprzedaży, w tym ceny, ilości produktów, oceny klientów, a także dane demograficzne klientów.

---

## Data Cleansing i Wrangling

### Załadowanie danych i pakietów

```{r load-packages}
# Instalacja pakietów (jeśli nie są zainstalowane)
required_packages <- c(
  "naniar", "dplyr", "ggplot2", "prettydoc", "mice", "shape", "jomo", "pan", "tidyverse", "dlookr", "editrules", "VIM", "validate", "errorlocate", "gtsummary", "cardx", "corrplot", "ggstatsplot"
)
new_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)

# Załadowanie pakietów
library(dplyr)
library(ggplot2)
library(naniar)
library(mice)
library(editrules)
library(validate)
library(corrplot)
library(gtsummary)
library(ggstatsplot)
library(errorlocate)
library(VIM)
```

### Wczytanie danych

```{r read-data}
# Wczytanie danych
library(readr)
supermarket_new <- read_csv("supermarket_new.csv")

# Podstawowa charakterystyka danych
summary(supermarket_new)
```

### Czyszczenie danych

#### Sprawdzenie braków danych

```{r missing-values}
# Liczba braków danych
n_miss(supermarket_new)
pct_miss(supermarket_new)
miss_var_summary(supermarket_new)
```

#### Usuwanie wartości specjalnych i zastosowanie reguł walidacji

```{r data-cleaning}
is.special <- function(x) {
  if (is.numeric(x)) !is.finite(x) else is.na(x)
}
for (n in colnames(supermarket_new)) {
  is.na(supermarket_new[[n]]) <- is.special(supermarket_new[[n]])
}

# Reguły walidacji
rules <- validator(
  `Unit price` > 0,
  Total <= `Unit price` * Quantity + `Tax 5%`,
  Rating >= 1 & Rating <= 10
)

# Zastosowanie reguł
validation_results <- confront(supermarket_new, rules)
summary(validation_results)

czyste_dane <-
  supermarket_new %>%
  replace_errors(rules)

errors_removed(czyste_dane)
```

---

## Wizualizacja Danych

### Braki danych

```{r visualize-missing-data}
# Mapa braków danych
vis_miss(supermarket_new)

# UpSet plot dla współwystępowania braków
library(naniar)
gg_miss_upset(supermarket_new, nsets = 3)
```

### Wykresy zależności

```{r scatter-plots}
# Zależność między Rating a Gross Income
ggplot(supermarket_new, aes(x = `gross income`, y = Rating)) +
  geom_point(aes(color = City), size = 2) +
  theme_minimal()

# Zależność między Rating a City
ggplot(supermarket_new, aes(x = Rating, y = City)) +
  geom_point(color = "darkorange", size = 2) +
  theme_minimal()
```


```{r clean data}
czyste_dane <- hotdeck(supermarket_new)

# Remove all *_imp columns
czyste_dane <- czyste_dane[, !grepl("_imp$", names(czyste_dane))]

```

### Wykresy podsumowujące sprzedaż

```{r summary-plots}
# Sprzedaż Total według miasta
czyste_dane %>%
  group_by(City) %>%
  summarise(Total_Sum = sum(Total, na.rm = TRUE)) %>%
  ggplot(aes(x = City, y = Total_Sum, fill = City)) +
  geom_bar(stat = "identity") +
  theme_minimal()

# Sprzedaż według typu klienta
czyste_dane %>%
  group_by(`Customer type`) %>%
  summarise(Total = n()) %>%
  ggplot(aes(x = `Customer type`, y = Total, fill = `Customer type`)) +
  geom_bar(stat = "identity") +
  theme_minimal()
```

---

## Analiza Opisowa

### Statystyki opisowe dla wybranych zmiennych

```{r descriptive-statistics}
czyste_dane %>%
  select(City, Gender, `Customer type`, `Product line`, Total, Rating, Quantity) %>%
  tbl_summary(by = Gender) %>%
  add_p() %>%
  bold_labels()
```

### Macierz korelacji

```{r correlation-matrix}
# Obliczanie korelacji
numeric_data <- czyste_dane %>% select(`Unit price`, Quantity, Total, `Tax 5%`)
corr_matrix <- cor(numeric_data, use = "complete.obs")

# Wizualizacja macierzy korelacji
corrplot(corr_matrix, method = "color")
```

---

## Wnioskowanie Statystyczne

### Porównanie cen jednostkowych między liniami produktów

```{r unit-price-comparison}
czyste_dane %>%
  ggbetweenstats(
    x = `Product line`,
    y = `Unit price`,
    pairwise.comparisons = TRUE,
    p.adjust.method = "bonferroni",
    ggtheme = theme_minimal()
  )
```

### Porównanie cen jednostkowych według typu klienta

```{r customer-type-comparison}
czyste_dane %>%
  ggbetweenstats(
    x = `Customer type`,
    y = `Unit price`,
    pairwise.comparisons = TRUE,
    p.adjust.method = "bonferroni",
    ggtheme = theme_minimal()
  )
```

---

## Podsumowanie i Wnioski

W analizie danych supermarketu odkryto kilka istotnych zależności:

- Cena jednostkowa różniła się istotnie w zależności od linii produktów.
- Sprzedaż Total była zróżnicowana między miastami oraz typami klientów.
- Braki danych były obecne w kilku kolumnach, lecz zostały skutecznie zarządzone.

Szczegółowe wykresy i tabele wspomagają wizualizację tych wyników.

---